# 《Bw-Tree：一种适用于新硬件平台的B树-译》 

**作者**: Justin J. Levandoski（贾斯汀·J·莱文多斯基），David B. Lomet（大卫·B·洛梅特），Sudipta Sengupta（苏迪普塔·森古普塔）  
**译者**: ULis3h ， ChatGpt ， 谷歌翻译

## 摘要
新硬件和平台的出现导致了对数据管理系统设计的重新考虑。然而，某些基本功能，如基于键的记录索引访问，仍然至关重要。虽然我们利用了先前系统的常见架构分层，但我们在每个层面上都做出了根本性的新设计决策。我们的新形式B树称为Bw-Tree，通过无锁的方法以及有效利用现代多核芯片的处理器缓存，实现了非常高的性能。我们的存储管理器使用一种独特的日志结构形式，模糊了页面和记录存储之间的区别，并且与闪存存储器很好地配合工作。本文描述了Bw-Tree的体系结构和算法，重点关注主存储器方面。论文还包括我们实验的结果，证明这种新颖方法能够产生出色的性能。

## I. 引言

### A. 原子记录存储
最近对NoSQL系统进行了许多讨论，它们本质上是原子记录存储（ARS）[1]。尽管其中一些系统是作为独立产品而设计的，但原子记录存储也可以作为更完整的事务性系统的组成部分，通过适当的控制操作[2]，[3]。实际上，可以将数据库系统视为包含原子记录存储作为其核心的一部分。  

原子记录存储（ARS）支持对单个记录的读取和写入操作，每个记录都由一个键进行标识。此外，基于树结构的原子记录存储支持对指定键范围的高性能键顺序访问。正是这种随机访问和键顺序访问的结合，使得B树成为数据库系统中首选的索引方法。  

然而，原子记录存储（ARS）不仅仅是一种访问方法。它还包括对稳定存储的管理，以及在系统崩溃时需要确保其更新是可恢复的。正是这种更全面形式的原子记录存储的性能，为嵌入了ARS的任何系统的性能提供了基础，包括功能齐全的数据库系统。  

本论文介绍了一种提供非常高性能的新型原子记录存储（ARS）。我们基于一种称为Bw-Tree的新型B树构建了我们的ARS。我们引入的技术使得Bw-Tree及其相关的存储管理器特别适用于近几年出现的新硬件环境。

本文的重点是Bw-Tree的主存储器方面。我们详细描述了我们的无锁技术，即如何在进行更新和结构修改操作时避免设置锁定。我们的方法还精心避免了缓存行失效，因此导致了更好的缓存性能。我们以高层次的方式描述了我们如何使用日志结构的存储管理器，但具体细节留待另一篇论文来介绍。  

### B. 新环境  
自上世纪70年代以来，数据库系统在存储和CPU基础设施方面大多保持不变。这种基础设施使用磁盘作为持久存储介质。然而，磁盘的延迟现在相当于往返冥王星所需的时间[4]。它使用的处理器的单处理器性能随着摩尔定律的增长而提高，因此限制了在单台机器上高水平并发执行的需求。而处理器现在已经不能提供越来越高的单核性能。简而言之，“这些变化了一切”。  

1）多核设计：我们现在生活在一个高峰值性能的多核世界。单核速度最多只会略微增加，因此我们需要在利用大量核心方面做得更好，至少需要解决两个重要方面的问题：
- 多核CPU要求高并发性能。但是，随着并发级别的增加，锁定操作更容易发生阻塞，从而限制了可伸缩性[5]。  
- 良好的多核处理器性能依赖于高CPU缓存命中率。在原地更新内存会导致缓存失效，因此需要非常小心地处理更新的方式和时间选择。   

针对第一个问题，Bw-Tree采用无锁机制，确保线程在发生冲突时不会放弃或重新定向其活动。针对第二个问题，Bw-Tree执行“增量”更新，避免在原地更新页面，从而保留先前缓存的页面行。

2）针对现代存储设备的设计：磁盘延迟是一个主要问题。但更为严重的是它们每秒的I/O操作数量很低。闪存存储提供了更高的每秒I/O操作数量，并且成本更低。这对于减少OLTP系统的成本非常重要。事实上，Amazon的DynamoDB明确包含了利用闪存的功能[6]。因此，Bw-Tree的目标是闪存存储。  
